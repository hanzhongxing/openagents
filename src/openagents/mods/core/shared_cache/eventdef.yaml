asyncapi: '3.0.0'
info:
  title: OpenAgents Core Shared Cache Mod API
  version: '1.0.0'
  description: |
    A shared caching system for OpenAgents with agent group-based access control.

    ## Features
    - Create cache entries with MIME type support
    - Agent group-based access control
    - Get, update, and delete cache entries
    - Real-time notifications for cache changes
    - Persistent storage in workspace

  contact:
    name: OpenAgents Team
  license:
    name: MIT

defaultContentType: application/json

channels:
  cacheCreate:
    address: shared_cache.create
    messages:
      cacheCreate:
        $ref: '#/components/messages/CacheCreateMessage'

  cacheGet:
    address: shared_cache.get
    messages:
      cacheGet:
        $ref: '#/components/messages/CacheGetMessage'

  cacheUpdate:
    address: shared_cache.update
    messages:
      cacheUpdate:
        $ref: '#/components/messages/CacheUpdateMessage'

  cacheDelete:
    address: shared_cache.delete
    messages:
      cacheDelete:
        $ref: '#/components/messages/CacheDeleteMessage'

  cacheCreateResponse:
    address: shared_cache.create.response
    messages:
      cacheCreateResponse:
        $ref: '#/components/messages/CacheCreateResponse'

  cacheGetResponse:
    address: shared_cache.get.response
    messages:
      cacheGetResponse:
        $ref: '#/components/messages/CacheGetResponse'

  cacheUpdateResponse:
    address: shared_cache.update.response
    messages:
      cacheUpdateResponse:
        $ref: '#/components/messages/CacheUpdateResponse'

  cacheDeleteResponse:
    address: shared_cache.delete.response
    messages:
      cacheDeleteResponse:
        $ref: '#/components/messages/CacheDeleteResponse'

  cacheCreatedNotification:
    address: shared_cache.notification.created
    messages:
      cacheCreatedNotification:
        $ref: '#/components/messages/CacheCreatedNotification'

  cacheUpdatedNotification:
    address: shared_cache.notification.updated
    messages:
      cacheUpdatedNotification:
        $ref: '#/components/messages/CacheUpdatedNotification'

  cacheDeletedNotification:
    address: shared_cache.notification.deleted
    messages:
      cacheDeletedNotification:
        $ref: '#/components/messages/CacheDeletedNotification'

operations:
  createCache:
    action: send
    channel:
      $ref: '#/channels/cacheCreate'
    summary: Create a new cache entry with optional agent group access control

  getCache:
    action: send
    channel:
      $ref: '#/channels/cacheGet'
    summary: Retrieve a cache entry by ID

  updateCache:
    action: send
    channel:
      $ref: '#/channels/cacheUpdate'
    summary: Update an existing cache entry

  deleteCache:
    action: send
    channel:
      $ref: '#/channels/cacheDelete'
    summary: Delete a cache entry

  # Receive operations
  receiveCacheCreateResponse:
    action: receive
    channel:
      $ref: '#/channels/cacheCreateResponse'
    summary: Receive cache creation response

  receiveCacheGetResponse:
    action: receive
    channel:
      $ref: '#/channels/cacheGetResponse'
    summary: Receive cache retrieval response

  receiveCacheUpdateResponse:
    action: receive
    channel:
      $ref: '#/channels/cacheUpdateResponse'
    summary: Receive cache update response

  receiveCacheDeleteResponse:
    action: receive
    channel:
      $ref: '#/channels/cacheDeleteResponse'
    summary: Receive cache deletion response

  receiveCacheCreatedNotification:
    action: receive
    channel:
      $ref: '#/channels/cacheCreatedNotification'
    summary: Receive notification when a cache entry is created

  receiveCacheUpdatedNotification:
    action: receive
    channel:
      $ref: '#/channels/cacheUpdatedNotification'
    summary: Receive notification when a cache entry is updated

  receiveCacheDeletedNotification:
    action: receive
    channel:
      $ref: '#/channels/cacheDeletedNotification'
    summary: Receive notification when a cache entry is deleted

components:
  parameters:
    cacheId:
      description: The unique identifier of a cache entry (UUID)

    agentId:
      description: The unique identifier of an agent in the OpenAgents network

    agentGroup:
      description: The name of an agent group

  messages:
    CacheCreateMessage:
      name: CacheCreateMessage
      title: Cache Create
      summary: Create a new cache entry
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/CacheCreatePayload'

    CacheGetMessage:
      name: CacheGetMessage
      title: Cache Get
      summary: Retrieve a cache entry
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/CacheGetPayload'

    CacheUpdateMessage:
      name: CacheUpdateMessage
      title: Cache Update
      summary: Update a cache entry
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/CacheUpdatePayload'

    CacheDeleteMessage:
      name: CacheDeleteMessage
      title: Cache Delete
      summary: Delete a cache entry
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/CacheDeletePayload'

    # Response messages
    CacheCreateResponse:
      name: CacheCreateResponse
      title: Cache Create Response
      summary: Response to cache creation operation
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/CacheCreateResponsePayload'

    CacheGetResponse:
      name: CacheGetResponse
      title: Cache Get Response
      summary: Response to cache retrieval operation
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/CacheGetResponsePayload'

    CacheUpdateResponse:
      name: CacheUpdateResponse
      title: Cache Update Response
      summary: Response to cache update operation
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/CacheUpdateResponsePayload'

    CacheDeleteResponse:
      name: CacheDeleteResponse
      title: Cache Delete Response
      summary: Response to cache deletion operation
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/CacheDeleteResponsePayload'

    # Notification messages
    CacheCreatedNotification:
      name: CacheCreatedNotification
      title: Cache Created Notification
      summary: Notification when a cache entry is created
      contentType: application/json
      x_event_type: notification
      payload:
        $ref: '#/components/schemas/CacheNotificationPayload'

    CacheUpdatedNotification:
      name: CacheUpdatedNotification
      title: Cache Updated Notification
      summary: Notification when a cache entry is updated
      contentType: application/json
      x_event_type: notification
      payload:
        $ref: '#/components/schemas/CacheNotificationPayload'

    CacheDeletedNotification:
      name: CacheDeletedNotification
      title: Cache Deleted Notification
      summary: Notification when a cache entry is deleted
      contentType: application/json
      x_event_type: notification
      payload:
        $ref: '#/components/schemas/CacheNotificationPayload'

  schemas:
    CacheCreatePayload:
      type: object
      required:
        - value
      properties:
        value:
          type: string
          description: The value to cache (stored as string)
          example: "This is cached data"
        mime_type:
          type: string
          description: MIME type of the cached value
          default: "text/plain"
          example: "application/json"
        allowed_agent_groups:
          type: array
          items:
            type: string
          description: List of agent groups that can access this cache (empty = all agents)
          default: []
          example: ["admin", "developers"]

    CacheGetPayload:
      type: object
      required:
        - cache_id
      properties:
        cache_id:
          type: string
          description: UUID of the cache entry to retrieve
          example: "550e8400-e29b-41d4-a716-446655440000"

    CacheUpdatePayload:
      type: object
      required:
        - cache_id
        - value
      properties:
        cache_id:
          type: string
          description: UUID of the cache entry to update
          example: "550e8400-e29b-41d4-a716-446655440000"
        value:
          type: string
          description: New value for the cache entry
          example: "Updated cached data"

    CacheDeletePayload:
      type: object
      required:
        - cache_id
      properties:
        cache_id:
          type: string
          description: UUID of the cache entry to delete
          example: "550e8400-e29b-41d4-a716-446655440000"

    # Response payload schemas
    CacheCreateResponsePayload:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the cache creation was successful
        cache_id:
          type: string
          description: UUID of the created cache entry (only present if success=true)
          example: "550e8400-e29b-41d4-a716-446655440000"
        error:
          type: string
          description: Error message if unsuccessful
          example: "value is required"

    CacheGetResponsePayload:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the cache retrieval was successful
        cache_id:
          type: string
          description: UUID of the cache entry
          example: "550e8400-e29b-41d4-a716-446655440000"
        value:
          type: string
          description: The cached value (only present if success=true)
          example: "This is cached data"
        mime_type:
          type: string
          description: MIME type of the cached value
          example: "application/json"
        allowed_agent_groups:
          type: array
          items:
            type: string
          description: List of agent groups that can access this cache
          example: ["admin", "developers"]
        created_by:
          type: string
          description: ID of the agent who created the cache entry
          example: "agent_alice"
        created_at:
          type: integer
          description: Unix timestamp when the cache entry was created
          example: 1699564800
        updated_at:
          type: integer
          description: Unix timestamp when the cache entry was last updated
          example: 1699651200
        error:
          type: string
          description: Error message if unsuccessful
          example: "Cache entry not found"

    CacheUpdateResponsePayload:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the cache update was successful
        cache_id:
          type: string
          description: UUID of the updated cache entry (only present if success=true)
          example: "550e8400-e29b-41d4-a716-446655440000"
        error:
          type: string
          description: Error message if unsuccessful
          example: "Agent does not have permission to update this cache entry"

    CacheDeleteResponsePayload:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the cache deletion was successful
        cache_id:
          type: string
          description: UUID of the deleted cache entry (only present if success=true)
          example: "550e8400-e29b-41d4-a716-446655440000"
        error:
          type: string
          description: Error message if unsuccessful
          example: "Access denied"

    # Notification payload schemas
    CacheNotificationPayload:
      type: object
      required:
        - cache_id
      properties:
        cache_id:
          type: string
          description: UUID of the cache entry that was modified
          example: "550e8400-e29b-41d4-a716-446655440000"
        mime_type:
          type: string
          description: MIME type of the cached value
          example: "application/json"
        created_by:
          type: string
          description: ID of the agent who created the cache entry
          example: "agent_alice"
        allowed_agent_groups:
          type: array
          items:
            type: string
          description: List of agent groups that can access this cache
          example: ["admin", "developers"]
