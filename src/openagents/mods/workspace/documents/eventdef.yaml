asyncapi: '3.0.0'
info:
  title: OpenAgents Shared Documents Mod API
  version: '1.0.0'
  description: |
    A document management mod for OpenAgents that provides:
    - Document creation and storage
    - Document renaming
    - Document content persistence
    - Version control
    - Document history tracking

    ## Features
    - Create and manage shared documents
    - Save document content
    - Rename documents
    - View document operation history
    - List all accessible documents

  contact:
    name: OpenAgents Team
  license:
    name: MIT

defaultContentType: application/json

channels:
  documentCreate:
    address: document.create
    messages:
      documentCreate:
        $ref: '#/components/messages/DocumentCreateMessage'

  documentSave:
    address: document.save
    messages:
      documentSave:
        $ref: '#/components/messages/DocumentSaveMessage'

  documentRename:
    address: document.rename
    messages:
      documentRename:
        $ref: '#/components/messages/DocumentRenameMessage'

  documentGet:
    address: document.get
    messages:
      documentGet:
        $ref: '#/components/messages/DocumentGetMessage'

  getHistory:
    address: document.get_history
    messages:
      getHistory:
        $ref: '#/components/messages/GetHistoryMessage'

  listDocuments:
    address: document.list
    messages:
      listDocuments:
        $ref: '#/components/messages/ListDocumentsMessage'

  # Response channels
  operationResponse:
    address: document.operation.response
    messages:
      operationResponse:
        $ref: '#/components/messages/OperationResponse'

  documentGetResponse:
    address: document.get.response
    messages:
      documentGetResponse:
        $ref: '#/components/messages/DocumentGetResponse'

  listResponse:
    address: document.list.response
    messages:
      listResponse:
        $ref: '#/components/messages/ListResponse'

  historyResponse:
    address: document.history.response
    messages:
      historyResponse:
        $ref: '#/components/messages/HistoryResponse'

  # Notification channels
  documentCreatedNotification:
    address: document.created
    messages:
      documentCreatedNotification:
        $ref: '#/components/messages/DocumentCreatedNotification'

  documentSavedNotification:
    address: document.saved
    messages:
      documentSavedNotification:
        $ref: '#/components/messages/DocumentSavedNotification'

  documentRenamedNotification:
    address: document.renamed
    messages:
      documentRenamedNotification:
        $ref: '#/components/messages/DocumentRenamedNotification'

operations:
  createDocument:
    action: send
    channel:
      $ref: '#/channels/documentCreate'
    summary: Create a new shared document

  saveDocument:
    action: send
    channel:
      $ref: '#/channels/documentSave'
    summary: Save document content

  renameDocument:
    action: send
    channel:
      $ref: '#/channels/documentRename'
    summary: Rename a document

  getDocument:
    action: send
    channel:
      $ref: '#/channels/documentGet'
    summary: Get document content

  getHistory:
    action: send
    channel:
      $ref: '#/channels/getHistory'
    summary: Get document operation history

  listDocuments:
    action: send
    channel:
      $ref: '#/channels/listDocuments'
    summary: List all accessible documents

  # Receive operations
  receiveOperationResponse:
    action: receive
    channel:
      $ref: '#/channels/operationResponse'
    summary: Receive operation response

  receiveDocumentGetResponse:
    action: receive
    channel:
      $ref: '#/channels/documentGetResponse'
    summary: Receive document get response

  receiveListResponse:
    action: receive
    channel:
      $ref: '#/channels/listResponse'
    summary: Receive document list response

  receiveHistoryResponse:
    action: receive
    channel:
      $ref: '#/channels/historyResponse'
    summary: Receive history response

  receiveDocumentCreatedNotification:
    action: receive
    channel:
      $ref: '#/channels/documentCreatedNotification'
    summary: Receive document created notification

  receiveDocumentSavedNotification:
    action: receive
    channel:
      $ref: '#/channels/documentSavedNotification'
    summary: Receive document saved notification

  receiveDocumentRenamedNotification:
    action: receive
    channel:
      $ref: '#/channels/documentRenamedNotification'
    summary: Receive document renamed notification

components:
  parameters:
    documentId:
      description: The unique identifier of a document

    agentId:
      description: The unique identifier of an agent

  messages:
    DocumentCreateMessage:
      name: DocumentCreateMessage
      title: Create Document
      summary: Create a new shared document
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/DocumentCreatePayload'

    DocumentSaveMessage:
      name: DocumentSaveMessage
      title: Save Document
      summary: Save document content
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/DocumentSavePayload'

    DocumentRenameMessage:
      name: DocumentRenameMessage
      title: Rename Document
      summary: Rename a document
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/DocumentRenamePayload'

    DocumentGetMessage:
      name: DocumentGetMessage
      title: Get Document
      summary: Get document content
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/DocumentGetPayload'

    GetHistoryMessage:
      name: GetHistoryMessage
      title: Get History
      summary: Get document history
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/GetHistoryPayload'

    ListDocumentsMessage:
      name: ListDocumentsMessage
      title: List Documents
      summary: List all accessible documents
      contentType: application/json
      x_event_type: operation
      payload:
        $ref: '#/components/schemas/ListDocumentsPayload'

    # Response messages
    OperationResponse:
      name: OperationResponse
      title: Operation Response
      summary: Response to document operation
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/OperationResponsePayload'

    DocumentGetResponse:
      name: DocumentGetResponse
      title: Document Get Response
      summary: Document content response
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/DocumentGetResponsePayload'

    ListResponse:
      name: ListResponse
      title: List Response
      summary: Document list response
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/ListResponsePayload'

    HistoryResponse:
      name: HistoryResponse
      title: History Response
      summary: Document history response
      contentType: application/json
      x_event_type: response
      payload:
        $ref: '#/components/schemas/HistoryResponsePayload'

    # Notification messages
    DocumentCreatedNotification:
      name: DocumentCreatedNotification
      title: Document Created Notification
      summary: Notification when a document is created
      contentType: application/json
      x_event_type: notification
      payload:
        $ref: '#/components/schemas/DocumentCreatedPayload'

    DocumentSavedNotification:
      name: DocumentSavedNotification
      title: Document Saved Notification
      summary: Notification when a document is saved
      contentType: application/json
      x_event_type: notification
      payload:
        $ref: '#/components/schemas/DocumentSavedPayload'

    DocumentRenamedNotification:
      name: DocumentRenamedNotification
      title: Document Renamed Notification
      summary: Notification when a document is renamed
      contentType: application/json
      x_event_type: notification
      payload:
        $ref: '#/components/schemas/DocumentRenamedPayload'

  schemas:
    DocumentCreatePayload:
      type: object
      required:
        - document_name
      properties:
        document_name:
          type: string
          description: Name of the document
          maxLength: 255
          example: "Project Requirements.md"
        initial_content:
          type: string
          description: Initial content of the document
          example: "# Project Requirements\n\n## Overview\n"
        access_permissions:
          type: object
          description: Agent access permissions (agent_id -> permission_level)
          additionalProperties:
            type: string
            enum: ["read_only", "read_write", "admin"]
          example:
            agent_alice: "read_write"
            agent_bob: "read_only"

    DocumentSavePayload:
      type: object
      required:
        - document_id
        - content
      properties:
        document_id:
          type: string
          description: ID of the document
          example: "doc_12345"
        content:
          type: string
          description: Document content to save
          example: "# Updated content\n\nThis is the new content."

    DocumentRenamePayload:
      type: object
      required:
        - document_id
        - new_name
      properties:
        document_id:
          type: string
          description: ID of the document
          example: "doc_12345"
        new_name:
          type: string
          description: New name for the document
          maxLength: 255
          example: "Updated Requirements.md"

    DocumentGetPayload:
      type: object
      required:
        - document_id
      properties:
        document_id:
          type: string
          description: ID of the document
          example: "doc_12345"

    GetHistoryPayload:
      type: object
      required:
        - document_id
      properties:
        document_id:
          type: string
          description: ID of the document
          example: "doc_12345"
        limit:
          type: integer
          minimum: 1
          maximum: 500
          default: 50
          description: Maximum number of operations to retrieve
        offset:
          type: integer
          minimum: 0
          default: 0
          description: Number of operations to skip

    ListDocumentsPayload:
      type: object
      properties: {}

    # Response payload schemas
    OperationResponsePayload:
      type: object
      properties:
        success:
          type: boolean
          description: Whether operation was successful
        message:
          type: string
          description: Response message
        error:
          type: string
          description: Error message if operation failed

    DocumentGetResponsePayload:
      type: object
      properties:
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        document_name:
          type: string
          description: Document name
          example: "Project Requirements.md"
        content:
          type: string
          description: Document content
          example: "# Project Requirements\n\n## Overview\n"
        version:
          type: integer
          description: Document version number
          example: 42
        creator_agent_id:
          type: string
          description: Creator agent ID
          example: "agent_alice"
        created_timestamp:
          type: string
          format: date-time
          description: Creation timestamp
        last_modified:
          type: string
          format: date-time
          description: Last modification timestamp

    ListResponsePayload:
      type: object
      properties:
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentMetadata'
          description: List of accessible documents

    HistoryResponsePayload:
      type: object
      properties:
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        operations:
          type: array
          items:
            $ref: '#/components/schemas/DocumentOperation'
          description: Operation history
        total_operations:
          type: integer
          description: Total number of operations
          example: 150

    # Notification payload schemas
    DocumentCreatedPayload:
      type: object
      properties:
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        document_name:
          type: string
          description: Document name
          example: "Project Requirements.md"
        creator_id:
          type: string
          description: Creator agent ID
          example: "agent_alice"
        timestamp:
          type: string
          format: date-time
          description: Creation timestamp

    DocumentSavedPayload:
      type: object
      properties:
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        document_name:
          type: string
          description: Document name
          example: "Project Requirements.md"
        agent_id:
          type: string
          description: Agent who saved the document
          example: "agent_alice"
        version:
          type: integer
          description: New document version
          example: 43
        timestamp:
          type: string
          format: date-time
          description: Save timestamp

    DocumentRenamedPayload:
      type: object
      properties:
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        old_name:
          type: string
          description: Previous document name
          example: "Project Requirements.md"
        new_name:
          type: string
          description: New document name
          example: "Updated Requirements.md"
        agent_id:
          type: string
          description: Agent who renamed the document
          example: "agent_alice"
        timestamp:
          type: string
          format: date-time
          description: Rename timestamp

    # Common schemas
    DocumentMetadata:
      type: object
      properties:
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        name:
          type: string
          description: Document name
          example: "Project Requirements.md"
        creator_agent_id:
          type: string
          description: Creator agent ID
          example: "agent_alice"
        created_timestamp:
          type: string
          format: date-time
          description: Creation timestamp
        last_modified:
          type: string
          format: date-time
          description: Last modification timestamp
        version:
          type: integer
          description: Document version
          example: 42

    DocumentOperation:
      type: object
      properties:
        operation_id:
          type: string
          description: Unique operation ID
          example: "op_uuid_123"
        document_id:
          type: string
          description: Document ID
          example: "doc_12345"
        agent_id:
          type: string
          description: Agent performing the operation
          example: "agent_alice"
        timestamp:
          type: string
          format: date-time
          description: Operation timestamp
        operation_type:
          type: string
          enum: ["create", "save", "rename"]
          description: Type of operation
        details:
          type: object
          description: Operation-specific details
          additionalProperties: true
