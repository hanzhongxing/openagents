syntax = "proto3";

package openagents;

import "google/protobuf/any.proto";

// Agent service for OpenAgents gRPC transport
service AgentService {
  // Unified event handling for all message and system command types
  rpc SendEvent(Event) returns (EventResponse);
  
  // Bidirectional streaming for events
  rpc StreamEvents(stream Event) returns (stream Event);
  
  // Agent registration and management
  rpc RegisterAgent(RegisterAgentRequest) returns (RegisterAgentResponse);
  rpc UnregisterAgent(UnregisterAgentRequest) returns (UnregisterAgentResponse);
  
  // Agent discovery
  rpc DiscoverAgents(DiscoverAgentsRequest) returns (DiscoverAgentsResponse);
  rpc GetAgentInfo(GetAgentInfoRequest) returns (GetAgentInfoResponse);
  
  // Heartbeat and health checks
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
  rpc GetNetworkInfo(NetworkInfoRequest) returns (NetworkInfoResponse);
}

// Unified event structure for all message and system command types
message Event {
  string event_id = 1;           // Unique event identifier
  string event_name = 2;         // Event type (e.g., "thread.channel_message.post", "thread.direct_message.send", "system.poll_messages")
  string source_id = 3;          // Source agent ID
  string target_agent_id = 4;    // Target agent ID (optional for broadcasts)
  google.protobuf.Any payload = 5;  // Event-specific data
  int64 timestamp = 6;
  map<string, string> metadata = 7;
  string visibility = 8;         // "local", "network", "external"
  string relevant_mod = 9;       // Specific mod to process this event (for MOD_ONLY visibility)
  string secret = 10;            // Authentication secret for the source agent
}

// Unified event response
message EventResponse {
  bool success = 1;
  string message = 2;
  google.protobuf.Any data = 3;
  string event_name = 4;
}

// Agent registration
message RegisterAgentRequest {
  string agent_id = 1;
  map<string, string> metadata = 2;
  repeated string capabilities = 3;
  bool force_reconnect = 4;
  string certificate = 5;
  string password_hash = 6;
}

message RegisterAgentResponse {
  bool success = 1;
  string error_message = 2;
  string secret = 3;
}

// Agent unregistration
message UnregisterAgentRequest {
  string agent_id = 1;
  string secret = 2;
}

message UnregisterAgentResponse {
  bool success = 1;
  string error_message = 2;
}

// Agent discovery
message DiscoverAgentsRequest {
  repeated string required_capabilities = 1;
}

message DiscoverAgentsResponse {
  repeated AgentInfo agents = 1;
}

message GetAgentInfoRequest {
  string agent_id = 1;
}

message GetAgentInfoResponse {
  AgentInfo agent = 1;
  bool found = 2;
}

// Agent information
message AgentInfo {
  string agent_id = 1;
  map<string, string> metadata = 2;
  repeated string capabilities = 3;
  int64 last_seen = 4;
  string transport_type = 5;
  string address = 6;
}

// Heartbeat for connection monitoring
message HeartbeatRequest {
  string agent_id = 1;
  int64 timestamp = 2;
}

message HeartbeatResponse {
  bool success = 1;
  int64 timestamp = 2;
}

// Network information
message NetworkInfoRequest {
}

message NetworkInfoResponse {
  string network_id = 1;
  string network_name = 2;
  bool is_running = 3;
  int64 uptime_seconds = 4;
  int32 agent_count = 5;
  repeated AgentInfo agents = 6;
  string topology_mode = 7;
  string transport_type = 8;
  string host = 9;
  int32 port = 10;
}
